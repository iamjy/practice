#!/bin/bash

include ./build/compiler.mk
include ./build/compile.mk

SHELL := /bin/bash

TOPDIR := $(PWD)
CURDIR := .
UPDIR  := ..

BUILD_OUT  := $(TOPDIR)/out
TARGET_OUT := $(BUILD_OUT)
export TARGET_OUT

AS	:= $(TARGET_TOOLCHAIN)as
LD	:= $(TARGET_TOOLCHAIN)ld
CC	:= $(TARGET_TOOLCHAIN)gcc
CXX	:= $(TARGET_TOOLCHAIN)g++
CPP	:= $(CC) -E
AR	:= $(TARGET_TOOLCHAIN)ar rscv
NM	:= $(TARGET_TOOLCHAIN)nm
LDR	:= $(TARGET_TOOLCHAIN)ldr
STRIP	:= $(TARGET_TOOLCHAIN)strip
OBJCOPY := $(TARGET_TOOLCHAIN)objcopy
OBJDUMP := $(TARGET_TOOLCHAIN)objdump
RANLIB	:= $(TARGET_TOOLCHAIN)ranlib
export AS LD CC CXX CPP AR NM LDR STRIP OBJCOPY OBJDUMP RANLIB

SRC_POINTER	:= $(CURDIR)/src/pointer
SRC_FUNCTION	:= $(CURDIR)/src/function
SRC_KEYWORD	:= $(CURDIR)/src/keyword
SRC_PARSING	:= $(CURDIR)/src/parsing
SRC_OPTIMIZING	:= $(CURDIR)/src/optimizing

BUILD_POINTER    := pointer
BUILD_FUNCTION 	 := function
BUILD_KEYWORD 	 := keyword
BUILD_PARSING	 := parsing
BUILD_OPTIMIZING := optimizing

all: $(BUILD_POINTER) $(BUILD_FUNCTION) $(BUILD_KEYWORD) $(BUILD_PARSING) $(BUILD_OPTIMIZING)

$(BUILD_POINTER):
	$(MAKE) -C $(SRC_POINTER)

$(BUILD_FUNCTION):
	$(MAKE) -C $(SRC_FUNCTION)

$(BUILD_KEYWORD):
	$(MAKE) -C $(SRC_KEYWORD)

$(BUILD_PARSING):
	$(MAKE) -C $(SRC_PARSING)

$(BUILD_OPTIMIZING):
	$(MAKE) -C $(SRC_OPTIMIZING)
